using static System.Math;

namespace MultiPrecisionSandbox {
    public static class ErrorFunction {
        static readonly double c = 1 / Sqrt(PI);

        static readonly double[] ts_nz = new double[] {
            -1d / 3d,
            +1d / 10d,
            -1d / 42d,
            +1d / 216d,
            -1d / 1320d,
            +1d / 9360d,
            -1d / 75600d,
            +1d / 685440d,
            -1d / 6894720d,
            +1d / 76204800d,
            -1d / 918086400d,
            +1d / 11975040000d,
            -1d / 168129561600d,
            +1d / 2528170444800d,
            -1d / 40537905408000d,
            +1d / 690452066304000d,
        };

        static readonly double[] rs_1p5 = new double[] {
            +3.1095937465872430474703598205072901656500748376732836959642566739845769011963784240021536729573150702001530299474900247240542481,
            +1.5821637914721947564375896697724479333452342581949092186423208779028727824221836709395254202775695505181407298760140901074901167,
            +6.8658146268639258168174230530074374088895178258106404796742783735049709498411467647727164214149744068771119165559710634063948357e-2,
            -2.1293361528117498877172303961970332365269207296505164596983145171675560820589693736854987153638639088025817546922103735757419293e-2,
            +5.5708963952021747713869749987931945916887490628025479250874820304382933974490674870618120006887993220402564017348619754739976044e-3,
            -1.1483549751873786866004512372192929248707434731511170207858961456956189668258462389056132545468468762214838151391039857189635185e-3,
            +1.3941750732978331542302758369841878515362476466315188822002883253412552573527602397574396018824224677843137623326851393050803386e-4,
            +1.8765579139434283867569679534629421967609580936180047110259787404443844048532373522315023324355409738569616291776245805110698141e-5,
            -1.8909876382516948036704564457939776715478358674063250870358256212548124562093002105310567475567981383706875511398079281079759262e-5,
            +7.2560337037752775451918202685231350517331785806497267907025419172371606589075721590542501359638331237423192836183067796861569807e-6,
            -1.8776513326041741100355169031548940693982069921589032671393033888862545781529587844968169646293427189396153174460275923519865778e-6,
            +2.9649434786746895900401466816801017589099157128604839827109663682426938169011758743708537152429822710484272878921814828752185832e-7,
            +1.2485372798601069308201905800660793232830801199601326091329613615398491174797705761639985504897393033298197015424003911120637036e-8,
            -2.9863652190314584024404635792400065508964649477184924650097842965362418618114718308549622070971409861768945239846142073249507737e-8,
            +1.2995145993611114096198914768481383509583585500534435338389315862578321600675197862319904242569195620968196608343106673894196912e-8,
            -3.6646296182832754387901371068794736222501715421930997416798673318750715789147582867257623862884093620283852667262192031175662476e-9,
            +6.5845245069356538595154656945509112992865924080161832506390547066419513883193042963738772892831855982088150663908488316880903458e-10,
        };

        static readonly double[] rs_2p5 = new double[] {
            +4.7436898048768291447341237781739007773951390789357085187990989502360358960066323058446139207843707566959711394193292870350084058,
            +1.6730080828304468375980956492431785643558761534539639760742658478952082767709556482094514349004009527243687014125824220661537870,
            +2.8868149258232230416521508236604821718713994432046612067183566945111062299796663126199995707598458309852157336146416342940382359e-2,
            -7.6764157373277573359686110267485028156117645284765800745274146981306701573583843921358079588133274834394033414593232988738174598e-3,
            +1.8652088489468875236382342145338644385750475528781160567333166687492567564149418672234184002984327598245961073427797964075928010e-3,
            -4.0960064271300454223343843878391427593591445853665888312103824916489068259036804155811344048469550464411763907115132223274823021e-4,
            +7.9131976374075332928125006361111786043368669257616844227462454451124188411754072746607649947341160761812419699113683339390557783e-5,
            -1.2541751242848223615996156201892683712852137397270073561689427820054637397387177701617268778490726968391320019661223498652014817e-5,
            +1.2440192749493911476228288481017723710043686568910849854498485894620545012874026375254866296214552732553058499780448019888192919e-6,
            +1.1172962270488237549932506614001324630828552988097133801973008699424873469399686414153790007982256435596834477436799103550821090e-7,
            -1.0657783651517062919449368702243270363267031065617454459964111611958513707307675330039940770609143446477777238520749502609088647e-7,
            +3.7367234799470416022431958856848413210069705420601000156885382417415394155564996270680485169791910950270482783918010098117973531e-8,
            -9.6879179302937465676641383956181629515082100065755863427468016192113480854500468887492038052878424392540100063916127196060333019e-9,
            +2.0070575856289171315566008080288014670719688634961233073845740213962016065788751661256295765085882759778619125381527499528593032e-9,
            -3.1351704723505078760354161963391283108504632114896283370202974715618458043886206868369961679977048746424831248080328905305514435e-10,
        };

        static readonly double[] rs_3p5 = new double[] {
            +6.4394130982304337280687084582386595684795836336034779400234591243239198070646243174870472034115869012484955346255162778339960757,
            +1.7135251747525370315784726880683356425035993909830338136722952759697504408353893069940568385058102633293402033081647112342627150,
            +1.3893357058487795285011426268923780646879284413092296617672141284741514088982281039933103284883049489407979013103989867594305021e-2,
            -3.0971409225510347150764260362397884047533324117178505997067014524577490072860500214836335184218094084049892301023031274667056195e-3,
            +6.5269627090948430728521500407746451989879026528665834424518183161463777341981935154854435703524960417309831115444452926875442025e-4,
            -1.2967116504859728344483681643067672750884768264960850074614491064457925338983188109869734882187134771593555555534574296549786155e-4,
            +2.4129211813357793710519424319063863371088855936373962991850442904776747640656963193520546823198699735507843903473212377162902814e-5,
            -4.1518976252346246159662886970720902076351363405772473034151241633119501664241920325651714067752892455964653497390877350517472782e-6,
            +6.4361132645081254815852503051376195649119389433888390159070520037923790194222247546722228044429728587337813444872376190041763102e-7,
            -8.4472093694671269958091378241044952023455378746989697310804338475029859423027414130233520848513721679243855156182182244118965504e-8,
            +7.5537355656101992378378188514181019970291720865505569678243536687457192504650697179338609439341327851017129759540343662601486023e-9,
            +2.6366346736644280260026805473955870818232190846937865266297760526588551056901511410977450150219196801847953133493877878989324720e-10,
            -3.5290936161108631225479443443447826316717908271504392381979866139941082538028092931817103586757516021921208042581863646874933642e-10,
            +1.1394783453301073647721369413852413087900738850184473135890179820672720526173776075057681180930746405717527289812793369300206684e-10,
            -2.7428179235994225274366311422825956996060079481756776040123184642050206744506232128781248715001476028745528801414689198792836728e-11,
        };

        public static double ErfNearZero(double z) {
            double w = z * z, v = w;

            double x = 1;

            foreach (double t in ts_nz) {
                x = FusedMultiplyAdd(t, v, x);
                v *= w;
            }

            double y = 2 * x * z * c;

            return y;
        }

        public static double ErfcRange12(double z) {
            double w = z - 1.5, v = 1;

            double x = 0;

            foreach (double r in rs_1p5) {
                x = FusedMultiplyAdd(r, v, x);
                v *= w;
            }

            double y = Exp(-z * z) / x;

            return y;
        }

        public static double ErfcRange23(double z) {
            double w = z - 2.5, v = 1;

            double x = 0;

            foreach (double r in rs_2p5) {
                x = FusedMultiplyAdd(r, v, x);
                v *= w;
            }

            double y = Exp(-z * z) / x;

            return y;
        }

        public static double ErfcRange34(double z) {
            double w = z - 3.5, v = 1;

            double x = 0;

            foreach (double r in rs_3p5) {
                x = FusedMultiplyAdd(r, v, x);
                v *= w;
            }

            double y = Exp(-z * z) / x;

            return y;
        }

        public static double ErfcLarger4(double z) {
            double w = z * z;

            double v = c * z * Exp(-w);

            double f = (12244648500d + w * (54875205000d + w * (68846500800d + w * (37349769600d + w * (10426416000d
                         + w * (1623847680d + w * (145259520d + w * (7346176d + w * (193536d + w * (2048d))))))))))
                        / (Sqrt(9370713555534515625d + w * (535167089943483375000d + w * (4947478840052713125000d + w * (17801196288958674900000d
                        + w * (33278674970250482850000d + w * (37290873521952388800000d + w * (27264582429908483520000d + w * (13741531501742634240000d
                        + w * (4956468805290339648000d + w * (1313137187487207936000d + w * (260148927642095923200d + w * (38989707018393600000d
                        + w * (4448461822571520000d + w * (386826204463104000d + w * (25529300926464000d + w * (1265116446720000d
                        + w * (46163815628800d + w * (1199819980800d + w * (20963655680d + w * (220200960d + w * (1048576d)))))))))))))))))))))
                        + (-3061162125d + w * (-35034079500d + w * (-58620523500d + w * (-30938846400d + w * (-4784551200d
                        + w * (747626880d + w * (339830400d + w * (45081600d + w * (2850560d + w * (87040d + w * (1024d))))))))))));

            return v * f;
        }
    }
}
